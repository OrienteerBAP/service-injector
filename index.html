<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>service-injector Demo</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f5f5f5;
      color: #333;
      line-height: 1.6;
      padding: 40px 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
    }

    header h1 {
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: #111;
    }

    header p {
      color: #666;
      font-size: 1rem;
    }

    .section {
      background: #fff;
      border-radius: 8px;
      padding: 20px 24px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .section-title {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #888;
      margin-bottom: 12px;
    }

    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    button {
      padding: 10px 18px;
      font-size: 0.9rem;
      font-weight: 500;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: #fff;
      color: #333;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    button:hover {
      background: #f0f0f0;
      border-color: #ccc;
    }

    button:active {
      transform: translateY(1px);
    }

    /* Selected state for single-select buttons */
    button.selected {
      background: linear-gradient(to bottom, #4a90d9, #357abd);
      border-color: #357abd;
      color: #fff;
    }

    button.selected:hover {
      background: linear-gradient(to bottom, #5a9fe9, #4589cc);
      border-color: #4589cc;
    }

    /* Toggle buttons - selected state (green) */
    button.toggle.selected {
      background: linear-gradient(to bottom, #48bb78, #38a169);
      border-color: #38a169;
      color: #fff;
    }

    button.toggle.selected:hover {
      background: linear-gradient(to bottom, #58cb88, #48b179);
      border-color: #48b179;
    }

    /* Toggle buttons - off state (subtle red tint) */
    button.toggle:not(.selected) {
      background: #fff;
      border-color: #ddd;
      color: #666;
    }

    button.toggle:not(.selected):hover {
      background: #fafafa;
      border-color: #ccc;
    }

    .note {
      margin-top: 24px;
      padding: 16px;
      background: #fffbeb;
      border: 1px solid #fcd34d;
      border-radius: 6px;
      font-size: 0.85rem;
      color: #92400e;
    }

    .note strong {
      font-weight: 600;
    }

    footer {
      text-align: center;
      margin-top: 40px;
      color: #888;
      font-size: 0.85rem;
    }

    footer a {
      color: #4a90d9;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>service-injector Demo</h1>
      <p>Select options to configure the floating window. Changes apply instantly.</p>
    </header>

    <div class="section">
      <div class="section-title">Tab Position</div>
      <div class="button-group" data-group="position">
        <button class="selected" onclick="selectOption(this, 'position', {p: 'bottom'})">Bottom</button>
        <button onclick="selectOption(this, 'position', {p: 'top'})">Top</button>
        <button onclick="selectOption(this, 'position', {p: 'left'})">Left</button>
        <button onclick="selectOption(this, 'position', {p: 'right'})">Right</button>
      </div>
    </div>

    <div class="section">
      <div class="section-title">Tab Offset</div>
      <div class="button-group" data-group="offset">
        <button onclick="selectOption(this, 'offset', {o: '25%'})">25%</button>
        <button onclick="selectOption(this, 'offset', {o: '50%'})">50%</button>
        <button class="selected" onclick="selectOption(this, 'offset', {o: '75%'})">75%</button>
        <button onclick="selectOption(this, 'offset', {o: '100px'})">100px</button>
        <button onclick="selectOption(this, 'offset', {o: '200px'})">200px</button>
      </div>
    </div>

    <div class="section">
      <div class="section-title">Window Size</div>
      <div class="button-group" data-group="size">
        <button onclick="selectOption(this, 'size', {ww: '300px', wh: '350px'})">Small (300x350)</button>
        <button class="selected" onclick="selectOption(this, 'size', {ww: '440px', wh: '550px'})">Medium (440x550)</button>
        <button onclick="selectOption(this, 'size', {ww: '600px', wh: '700px'})">Large (600x700)</button>
      </div>
    </div>

    <div class="section">
      <div class="section-title">Animation Speed</div>
      <div class="button-group" data-group="animation">
        <button onclick="selectOption(this, 'animation', {a: 0})">None (instant)</button>
        <button onclick="selectOption(this, 'animation', {a: 150})">Fast (150ms)</button>
        <button class="selected" onclick="selectOption(this, 'animation', {a: 300})">Normal (300ms)</button>
        <button onclick="selectOption(this, 'animation', {a: 600})">Slow (600ms)</button>
      </div>
    </div>

    <div class="section">
      <div class="section-title">Features</div>
      <div class="button-group">
        <button class="toggle selected" onclick="toggleOption(this, 'd')">Draggable</button>
        <button class="toggle selected" onclick="toggleOption(this, 'r')">Resizable</button>
        <button class="toggle" onclick="toggleOption(this, 'ht')">Hide Tab</button>
      </div>
    </div>

    <div class="section">
      <div class="section-title">URL to Load</div>
      <div class="button-group" data-group="url">
        <button class="selected" onclick="selectOption(this, 'url', {url: null})">Default</button>
        <button onclick="selectOption(this, 'url', {url: 'https://en.wikipedia.org'})">Wikipedia</button>
        <button onclick="selectOption(this, 'url', {url: 'https://www.openstreetmap.org/export/embed.html'})">OpenStreetMap</button>
        <button onclick="selectOption(this, 'url', {url: 'https://example.com'})">Example</button>
        <button onclick="selectOption(this, 'url', {url: 'https://archive.org'})">Archive.org</button>
      </div>
    </div>

    <div class="section">
      <div class="section-title">Theme</div>
      <div class="button-group" data-group="theme">
        <button class="selected" onclick="selectTheme(this, 'default')">Default</button>
        <button onclick="selectTheme(this, 'blue')">Blue</button>
        <button onclick="selectTheme(this, 'dark')">Dark</button>
        <button onclick="selectTheme(this, 'minimal')">Minimal</button>
      </div>
    </div>

    <div class="note">
      <strong>Tip:</strong> After selecting options, look for the floating tab on the edge of the screen. 
      Click the tab to open the window. You can drag the window header and resize from the bottom-right corner 
      (if those features are enabled).
    </div>

    <footer>
      <a href="https://github.com/OrienteerDW/service-injector" target="_blank">View on GitHub</a>
    </footer>
  </div>

  <script>
    // Current configuration state
    var currentConfig = {
      p: 'bottom',
      o: '75%',
      ww: '440px',
      wh: '550px',
      a: 300,
      d: true,
      r: true,
      ht: false,
      url: null
    };

    // Theme definitions
    var themes = {
      default: {
        tabTemplate: null,
        windowTemplate: null,
        styles: null
      },
      blue: {
        tabTemplate: "<a onclick='return %prefix%ToggleWindow();' href='%url%'>ðŸ’¬ Open</a>",
        windowTemplate: null,
        styles: "#%prefix%-tab { background: linear-gradient(to bottom, #4a90d9, #357abd); color: white; border: none; border-radius: 8px; padding: 12px 16px; }" +
                "#%prefix%-header { background: #357abd; color: white; }" +
                "#%prefix%-window { border: 2px solid #357abd; border-radius: 8px; overflow: hidden; }" +
                "#%prefix%-header a { color: white; }"
      },
      dark: {
        tabTemplate: "<a onclick='return %prefix%ToggleWindow();' href='%url%'>âš¡ Launch</a>",
        windowTemplate: null,
        styles: "#%prefix%-tab { background: #1a1a2e; color: #eee; border: 1px solid #444; }" +
                "#%prefix%-header { background: #16213e; color: #eee; }" +
                "#%prefix%-window { background: #1a1a2e; border: 1px solid #444; }" +
                "#%prefix%-body { border-color: #444; }" +
                "#%prefix%-header a { color: #eee; }" +
                "#%prefix%-resizer { border-color: #666; }"
      },
      minimal: {
        tabTemplate: "<a onclick='return %prefix%ToggleWindow();' href='%url%'>â˜°</a>",
        windowTemplate: null,
        styles: "#%prefix%-tab { background: #f8f8f8; border: 1px solid #ddd; padding: 8px 12px; }" +
                "#%prefix%-header { background: #f0f0f0; }" +
                "#%prefix%-window { border: 1px solid #ddd; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-radius: 4px; overflow: hidden; }"
      }
    };

    var currentTheme = 'default';
    var injectorStyleElement = null;

    // Clean up existing injector
    function cleanup() {
      // Use library's destroy method if available
      if (typeof window.siDestroy === 'function') {
        window.siDestroy();
      }

      // Remove existing script tag
      var oldScript = document.getElementById('service-injector');
      if (oldScript) {
        oldScript.parentNode.removeChild(oldScript);
      }

      // Fallback cleanup for any remaining elements
      var root = document.getElementById('si-service-injector');
      if (root) {
        root.parentNode.removeChild(root);
      }

      // Remove any orphaned injector styles
      var styles = document.querySelectorAll('style');
      for (var i = 0; i < styles.length; i++) {
        if (styles[i].innerHTML.indexOf('#si-tab') !== -1 ||
            styles[i].innerHTML.indexOf('#si-window') !== -1) {
          styles[i].parentNode.removeChild(styles[i]);
        }
      }

      injectorStyleElement = null;
    }

    // Load injector with current configuration
    function loadInjector() {
      // Clean up any existing injector
      cleanup();

      // Set up global config for templates based on selected theme
      var theme = themes[currentTheme] || themes.default;
      window.serviceInjectorConfig = {};
      if (theme.tabTemplate) {
        window.serviceInjectorConfig.tabTemplate = theme.tabTemplate;
      }
      if (theme.windowTemplate) {
        window.serviceInjectorConfig.windowTemplate = theme.windowTemplate;
      }
      if (theme.styles) {
        window.serviceInjectorConfig.styles = theme.styles;
      }

      // Build query string from currentConfig
      var params = [];
      for (var key in currentConfig) {
        if (currentConfig.hasOwnProperty(key) && currentConfig[key] !== null) {
          params.push(key + '=' + encodeURIComponent(currentConfig[key]));
        }
      }
      var queryString = params.length > 0 ? '?' + params.join('&') : '';

      // Create and inject new script
      var script = document.createElement('script');
      script.id = 'service-injector';
      script.src = 'injector.js' + queryString;
      
      // Track the style element that will be added
      var styleCount = document.querySelectorAll('style').length;
      script.onload = function() {
        var newStyles = document.querySelectorAll('style');
        if (newStyles.length > styleCount) {
          injectorStyleElement = newStyles[newStyles.length - 1];
        }
      };

      document.body.appendChild(script);
    }

    // Single-select: select one option in a group
    function selectOption(button, group, configUpdates) {
      // Remove .selected from all buttons in this group
      var groupContainer = document.querySelector('[data-group="' + group + '"]');
      if (groupContainer) {
        var buttons = groupContainer.querySelectorAll('button');
        for (var i = 0; i < buttons.length; i++) {
          buttons[i].classList.remove('selected');
        }
      }

      // Add .selected to clicked button
      button.classList.add('selected');

      // Merge configUpdates into currentConfig
      for (var key in configUpdates) {
        if (configUpdates.hasOwnProperty(key)) {
          currentConfig[key] = configUpdates[key];
        }
      }

      // Reload injector with new config
      loadInjector();
    }

    // Toggle: toggle a feature on/off
    function toggleOption(button, configKey) {
      // Toggle .selected class
      button.classList.toggle('selected');

      // Toggle the config value
      currentConfig[configKey] = !currentConfig[configKey];

      // Reload injector with new config
      loadInjector();
    }

    // Select theme
    function selectTheme(button, themeName) {
      // Update button selection UI
      var groupContainer = document.querySelector('[data-group="theme"]');
      var buttons = groupContainer.querySelectorAll('button');
      for (var i = 0; i < buttons.length; i++) {
        buttons[i].classList.remove('selected');
      }
      button.classList.add('selected');

      // Store current theme
      currentTheme = themeName;

      // Reload injector with new theme
      loadInjector();
    }

    // Load default injector on page load
    window.onload = function() {
      loadInjector();
    };
  </script>
</body>
</html>
